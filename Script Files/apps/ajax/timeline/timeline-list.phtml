<?php
require_once("../../../core/vipub_web_core.phtml");
$settings = vipub_site_settings();
$user_language = vipub_user_acceptLanguage();
$vipub["account"] = vipub_my_user_info();


$sql = "SELECT p.*, u.* 
  FROM vipub_posts p 
  JOIN vipub_users u ON p.user_id = u.id
  WHERE (p.user_id = ? OR p.user_id IN (
    SELECT user_id FROM vipub_follow WHERE follower_id = ?
  )) 
  AND (p.post_type = 'post' OR p.post_type = 'post_video' OR p.post_type = 'postAds')
  ORDER BY p.post_joined DESC";
  $stmt = mysqli_prepare($conn, $sql);
  mysqli_stmt_bind_param($stmt, "ii", $_SESSION["user_id"], $_SESSION["user_id"]);
  mysqli_stmt_execute($stmt);
  $result = mysqli_stmt_get_result($stmt);

if ($result) {
  if (mysqli_num_rows($result) > 0) {
    while ($row = mysqli_fetch_assoc($result)) {
      $postId = htmlspecialchars($row["p_id"], ENT_QUOTES, "UTF-8");
      $userId = htmlspecialchars($row["user_id"], ENT_QUOTES, "UTF-8");
      $username = htmlspecialchars($row["username"], ENT_QUOTES, "UTF-8");
      $fullname = htmlspecialchars($row["fullname"], ENT_QUOTES, "UTF-8");
      $avatar = htmlspecialchars($row["avatar"], ENT_QUOTES, "UTF-8");
      $content = htmlspecialchars($row["content_post"], ENT_QUOTES, "UTF-8");
      require("../../../themes/default/apps/timeline/content.phtml");
    }
  } else {
    vipub_template("timeline/include/no-post");
  }
} else {
  die("Hata: " . mysqli_error($conn));
}
mysqli_stmt_close($stmt);
mysqli_close($conn);
?>
