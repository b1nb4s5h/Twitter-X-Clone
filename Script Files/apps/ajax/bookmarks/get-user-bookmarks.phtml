<?php
require_once("../../../core/vipub_web_core.phtml");
$settings = vipub_site_settings();
$user_language = vipub_user_acceptLanguage();

$sql = "SELECT p.*, u.*, bo.*
  FROM vipub_posts p 
  JOIN vipub_users u ON p.user_id = u.id 
  JOIN vipub_bookmarks bo ON p.p_id = bo.post_id
  WHERE bo.user_id = ?
  AND (p.post_type = 'post' OR p.post_type = 'post_image' OR p.post_type = 'post_video' OR p.post_type = 'postAds' OR p.post_type = 'reply')
  ORDER BY bo.post_bookmarks DESC";

$stmt = mysqli_prepare($conn, $sql);
mysqli_stmt_bind_param($stmt, "i", $_SESSION["user_id"]);
mysqli_stmt_execute($stmt);
$result = mysqli_stmt_get_result($stmt);

if ($result) {
  if (mysqli_num_rows($result) > 0) {
    while ($row = mysqli_fetch_assoc($result)) {
      $postId = htmlspecialchars($row["p_id"], ENT_QUOTES, "UTF-8");
      $userId = htmlspecialchars($row["user_id"], ENT_QUOTES, "UTF-8");
      $username = htmlspecialchars($row["username"], ENT_QUOTES, "UTF-8");
      $fullname = htmlspecialchars($row["fullname"], ENT_QUOTES, "UTF-8");
      $avatar = htmlspecialchars($row["avatar"], ENT_QUOTES, "UTF-8");
      $content = htmlspecialchars($row["content_post"], ENT_QUOTES, "UTF-8");
      require("../../../themes/default/apps/timeline/content.phtml");
    }
  } else {
    require("../../../themes/default/apps/bookmarks/includes/no-bookmarks.phtml");
  }
} else {
  die("Hata: " . mysqli_error($conn));
}

mysqli_stmt_close($stmt);
mysqli_close($conn);
?>